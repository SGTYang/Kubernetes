# 로깅

클러스터 환경에서 앱 컨테이너를 운영할 때 주의해야 할 것 중 하나는 로그 처리입니다. 컨테이너 오케스트레이터를 사용하는 환경에서 로그를 수집할 때 주의해야 할 점 중 하나는 특별한 상황을 제외하고는 로그를 로컬 디스크에 파일로 저장하지 않아야 한다는 점이다. 

전통적인 애플리케이션 운영 환경에서는 로컬 파일 시스템의 지정된 위치에 파일로 로그를 저장하도록 하는데 디스크를 더이상 사용할 수 없을 때까지 로그를 저장하지 않도록 logrotate라는 프로그램을 사용하거나 로그 관련 라이브러리 및 프레임워크에 옵션을 설정한다.

이런 방식은 애플리케이션이 항상 지정된 장비에서 실행된다는 것을 가정하에 둔다. 그래서 문제가 발생하면 운영 중이던 장비에서 로그를 확인해 해결한다. 그런데 운영 중인 장비가 많으면 모든 장비에서 로그를 확인하기 어렵다. 

컨테이너 오케스트레이터를 사용하는 시스템이면 로그 확인이 더 어려울 수 있다. 컨테이너는 상황에 따라 클러스터 안 여러 노드를 옮겨 다니기 때문이다. 이럴 떄 특정 앱 컨테이너의 로그를 확인하려면 전체 클러스터의 노드 중 어떤 노드에 해당 컨테이너가 실행되었는지 확인해야 로그도 확인할 수 있다. 쿠버네티스는 여러가지 기능으로 이런 작업들을 쉽게 할 수 있다.

* 파드 로그 확인하기
  쿠버네티스의 kubectl은 개별 노드에 접근하지 않고 직접 파드의 로그를 확인할 수 있다. 이때 kubectl logs -f 파드이름 으로 명령을 사용한다. -f 옵션은 실행 중인 로그를 지속해서 수집하는 테일링을 실행한다. 
  
 *  오픈소스 도구 이용
로컬 디스크에 로그를 저장하면 용량 문제로 삭제한 예전 로그들을 확인할 수 없다. 트래픽이 많은 서버는 저장하는 로그 용량도 많으므로 한 시간 단위 어쩌면 그보다 더 빨리 로그를 삭제할 수도 있다. 문제가 생긴 것을 인식해 로그를 확인하려고 서버에 접속했는데 이미 로그가 삭제된 후 일지도 모른다. 이런 문제점을 개선하려고 장비 각각에 저장한 로그를 한 곳에 모아서 살펴보도록 서버를 구축한다. 이렇게 로그를 모아 살펴보도록 하는 오픈 소스 도구로는 Kafka, Fluentd, Logstash, Elasticsearch, Kibana등이 있다.  퍼블릭 클라우드라면 서비스 각각에서 제공하는 로그 수집 도구를 사용할 수도 있다.로그 수집기에서 수집한 로그를 저장할 엘라스틱서치와 로그를 조회할 키바나를 이용한다.

엘라스틱서치는 클러스터 형태로 여러 대 노드에서 실행하도록 개발한 검색 엔진 시스템이다.
